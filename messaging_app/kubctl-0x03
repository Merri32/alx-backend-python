#!/bin/bash

# Apply the updated blue deployment
kubectl apply -f blue_deployment.yaml

# Trigger rolling update and monitor
kubectl rollout status deployment/django-app-blue

# Test for downtime
echo "Testing app availability..."
for i in {1..10}
do
  curl -s http://<service-ip-or-url>:8000/ > /dev/null
  if [ $? -eq 0 ]; then
    echo "Request $i: Success"
  else
    echo "Request $i: Failed"
  fi
  sleep 1
done

# Verify current pods
kubectl get pods
